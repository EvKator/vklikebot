{"version":3,"sources":["../src/interaction.js"],"names":["request","require","cheerio","onText","msg","match","user","getSender","ExistInDB","saveToDB","greeting","sendTextMessage","last_message_id","message_id","status","vk_acc_addition","query","queryPost","search","link","exec","required","createVkPhotoLikeTask","SendToAll","createVkPostLikeTask","err","console","log","stack","sendMenu","key","userDestination","fromDB","Number","SendTo","PayTo","checkAllTasks","on","data","balance","sendStats","sendAccsEditionMenu","sendEarnMenu","sendTasksMenu","sendVkCreationTaskMenu","vk_acc","uname","sendConfitmVkAccMenu","delVkAcc","task","GetTaskForUser","sendEarnVkPhotoLikeTaskMenu","sendEarnVkPostLikeTaskMenu","taskname_query","taskname","confirmTask","text","cost","sendNextTaskMenu","type","answerCallbackQuery","id","messageText","test","addVkAcc"],"mappings":"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","file":"interaction.js","sourcesContent":["let request = require('request');\r\nlet cheerio = require('cheerio');\r\nimport nMenu from './nmenu';\r\nimport bot from './TeleBot';\r\nimport User from './user';\r\nimport Task from './task';\r\nimport Admin from './admin';\r\nimport { WSAEUSERS } from 'constants';\r\n\r\n\r\nbot.onText(/\\/start/, async function (msg, match) {\r\n\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB){\r\n        await user.saveToDB();\r\n        var greeting = \"Привет! \\n\" +\r\n       \" Этот бот поможет тебе накрутить лайки на фотографии, посты в ВК, подписчиков, или заработать на этом.  \\n\" +\r\n       \" Также есть возможность просматривать посты, подписываться на каналы в телеграм, получая за это оплату.  \\n\" +\r\n       \" Стоимость одного лайка - 20 коп. \\n\" +\r\n       \" Каждому пользователю предоставляется при регистрации 1 руб (4 лайка).  \\n\" +\r\n       \" Далее, чтобы пополнять  \\n\" +\r\n     \"баланс, следует выполнять задания или пополнить счет через банковскую карту. \\n\" +\r\n     \" Чтобы выполнять задания, следует привязать аккаунт ВК. \\n\" +\r\n     \" ВАЖНО: \\n\" +\r\n     \"1) Аккаунт должен быть открыт для всех в интернете \\n\" +\r\n     \"2) Должна стоять аватарка \\n\" +\r\n     \"3) За отписки, снятие лайков после выполнения задания баланс обнуляется. \\n\" +\r\n     \" \\n\" +\r\n     \"  За АБСОЛЮТНО ЛЮБОЙ помощью можете обращаться в техподдержку (пункт \\\"Помощь\\\" главного меню). Мы - адекватные, общительные люди.\";//\"Привет! Этот бот поможет тебе накрутить лайки в соц.сетях, или заработать, просто лайкая других \";\r\n        await nMenu.sendTextMessage(user, greeting);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n    else{\r\n        const greeting = \"С тобой мы уже знакомы\";\r\n        await nMenu.sendTextMessage(user, greeting);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n});\r\n\r\nbot.onText(/(.*)/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    //bot.sendMessage(msg.from.id, match[1] );\r\n    try{\r\n        \r\n        if(!user.ExistInDB)\r\n            await user.saveToDB();\r\n        user.last_message_id = msg.message_id;\r\n        switch (user.status){\r\n            case 'vk_acc_addition':\r\n                await vk_acc_addition(user, match[1]);\r\n                break;\r\n            case 'create_vk_photo_like_task(link)':\r\n                user.status = 'create_vk_photo_like_task(required){' + match[1] + '})';\r\n                await nMenu.sendTextMessage(user, \"Сколько лайков хочешь получить?\");\r\n\r\n\r\n                break;\r\n            case 'create_vk_post_like_task(link)':\r\n            \r\n                throw \"Извини, функционал для этой задачи будет реализован в течение недели\";\r\n                user.status = 'create_vk_post_like_task(required){' + match[1] + '})';\r\n                await nMenu.sendTextMessage(user, \"Сколько лайков хочешь получить?\");\r\n                break;\r\n            default:\r\n                const query = /create_vk_photo_like_task\\(required\\)\\{(.*)\\}/;\r\n                const queryPost = /create_vk_post_like_task\\(required\\)\\{(.*)\\}/;\r\n                if(user.status.search(query) >= 0){\r\n                    let link = query.exec(user.status)[1];\r\n                    let required = ((/(\\d*)/g).exec(match))[1];\r\n                    await user.createVkPhotoLikeTask(link,match[1]);\r\n                    await Admin.SendToAll(\"Появилось новое задание!\");\r\n                    //nMenu.sendMenu(user);\r\n\r\n                    break;\r\n                }\r\n                else if(user.status.search(queryPost) >= 0){\r\n                    //throw \"Извини, функционал для этой задачи будет реализован в течение недели\";\r\n                    let link = user.status.match(queryPost)[1];\r\n                    let required = ((/(\\d*)/g).exec(match))[1];\r\n                    required = ((/(\\d*)/g).exec(match))[1];\r\n                    await user.createVkPostLikeTask(link,match[1]);\r\n                    await nMenu.sendTextMessage(user, \"Молодец, задание создано успешно!\");\r\n                    //nMenu.sendMenu(user);\r\n\r\n                    break;\r\n                }\r\n                user.status = 'free';\r\n            }\r\n    }\r\n    catch(err){\r\n        console.log(err.stack);\r\n        user.status = 'free';\r\n        await nMenu.sendTextMessage(user, err);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n\r\n});\r\n\r\nbot.onText(/\\/menu/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB)\r\n        await user.saveToDB();\r\n    user.last_message_id = msg.message_id;\r\n    nMenu.sendMenu(user);\r\n});\r\n\r\nbot.onText(/\\/sendtoall (.*)/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB)\r\n        await user.saveToDB();\r\n    try{\r\n        if(user.key == 'Slava_Ukraini!'){\r\n            await Admin.SendToAll(match[1]);\r\n            nMenu.sendTextMessage(user, 'Success');\r\n        }\r\n    }\r\n    catch(err){\r\n        console.log('err');\r\n        console.log(err.stack);\r\n        nMenu.sendTextMessage(user, 'Error');\r\n    }\r\n    user.last_message_id = msg.message_id;\r\n});\r\n\r\nbot.onText(/\\/sendto (\\d+) (.*)/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB)\r\n        await user.saveToDB();\r\n    try{\r\n        if(user.key == 'Slava_Ukraini!'){\r\n            let userDestination = await User.fromDB(Number(match[1]));\r\n            await Admin.SendTo(userDestination, match[2]);\r\n            nMenu.sendTextMessage(user, 'Success');\r\n        }\r\n    }\r\n    catch(err){\r\n        console.log('err');\r\n        console.log(err.stack);\r\n        nMenu.sendTextMessage(user, 'Error');\r\n    }\r\n    user.last_message_id = msg.message_id;\r\n});\r\n\r\nbot.onText(/\\/payto (\\d+) (\\d+)/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB)\r\n        await user.saveToDB();\r\n    try{\r\n        if(user.key == 'Slava_Ukraini!'){\r\n            let userDestination = await User.fromDB(Number(match[1]));\r\n            await Admin.PayTo(userDestination, match[2]);\r\n            nMenu.sendTextMessage(user, 'Success');\r\n        }\r\n    }\r\n    catch(err){\r\n        console.log('err');\r\n        console.log(err.stack);\r\n        nMenu.sendTextMessage(user, 'Error');\r\n    }\r\n    user.last_message_id = msg.message_id;\r\n});\r\n\r\nbot.onText(/\\/paytome (\\d+)/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB)\r\n        await user.saveToDB();\r\n    try{\r\n        if(user.key == 'Slava_Ukraini!'){\r\n            await Admin.PayTo(user, match[1]);\r\n            nMenu.sendTextMessage(user, 'Success');\r\n        }\r\n    }\r\n    catch(err){\r\n        console.log('err');\r\n        console.log(err.stack);\r\n        nMenu.sendTextMessage(user, 'Error');\r\n    }\r\n    user.last_message_id = msg.message_id;\r\n});\r\n\r\nbot.onText(/\\/checkalltasks/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB)\r\n        await user.saveToDB();\r\n    try{\r\n        if(user.key == 'Slava_Ukraini!'){\r\n            Admin.checkAllTasks();\r\n        }\r\n    }\r\n    catch(err){\r\n        console.log('err');\r\n        console.log(err.stack);\r\n        nMenu.sendTextMessage(user, 'Error');\r\n    }\r\n    user.last_message_id = msg.message_id;\r\n    nMenu.sendMenu(user);\r\n});\r\n\r\nbot.on('callback_query', async function (msg) {\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB)\r\n        await user.saveToDB();\r\n    try{\r\n        console.log(msg.data);\r\n        switch (msg.data){\r\n            case '/replenishMoney':\r\n                throw \"Автоматизированная данная функция появится в течение недели. Сейчас для пополнения можете обратиться напрямую в \\\"Помощь\\\"\";\r\n                user.status = 'free';\r\n            case '/withdrawMoney':\r\n                throw \"Вывод меньше 10р запрещен, у тебя \" + user.balance + \". Извини, товарищ... Комиссии.. Потрудись еще немного и возвращайся!\";\r\n                user.status = 'free';\r\n            case '/stats':\r\n                nMenu.sendStats(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/profiles':\r\n                nMenu.sendAccsEditionMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/earn':\r\n                nMenu.sendEarnMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/tasks':\r\n                nMenu.sendTasksMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/createTask':\r\n                nMenu.sendVkCreationTaskMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/create_vk_photo_like_task':\r\n                if(user.vk_acc.uname){\r\n                    await nMenu.sendTextMessage(user, 'Пожалуйста, дай нам ссылку на фотографию');\r\n                    user.status = 'create_vk_photo_like_task(link)';\r\n                }\r\n                else{\r\n                    await nMenu.sendTextMessage(user, 'Привяжи ВК аккаунт, чтобы выполнять такие задания');\r\n                    //nMenu.sendMenu(user);\r\n                }\r\n                break;\r\n            case '/create_vk_post_like_task':\r\n                throw \"Извини, функционал для этой задачи будет реализован в течение недели\";\r\n                if(user.vk_acc.uname){\r\n                    await nMenu.sendTextMessage(user, 'Пожалуйста, дай нам ссылку на пост');\r\n                    user.status = 'create_vk_post_like_task(link)';\r\n                }\r\n                else{\r\n                    await nMenu.sendTextMessage(user, 'Привяжи ВК аккаунт, чтобы выполнять такие задания');\r\n                    //nMenu.sendMenu(user);\r\n                }\r\n                break;\r\n            case '/addVkAcc':\r\n                user.status = 'vk_acc_addition';\r\n                nMenu.sendConfitmVkAccMenu(user);\r\n                break;\r\n            case '/delVkAcc':\r\n                await user.delVkAcc();\r\n                await nMenu.sendTextMessage(user,\"Аккаунт благополучно отвязан\");\r\n                user.status = 'free';\r\n                //nMenu.sendMenu(user);\r\n                break;\r\n            case '/menu':\r\n                nMenu.sendMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/earn_vk_photo_like_task':{\r\n                let task = await Task.GetTaskForUser(user, 'vk_photo_like_task');\r\n                console.log(task);\r\n                nMenu.sendEarnVkPhotoLikeTaskMenu(user, task);\r\n                user.status = 'free';\r\n                break;\r\n            }\r\n            case '/earn_vk_post_like_task':{\r\n                \r\n                throw \"Извини, функционал для этой задачи будет реализован в течение недели\";\r\n                let task = await Task.GetTaskForUser(user, 'vk_post_like_task');\r\n                console.log(task);\r\n                nMenu.sendEarnVkPostLikeTaskMenu(user, task);\r\n                user.status = 'free';\r\n                break;\r\n            }\r\n            case '/earn_vk_subscribers_task':\r\n            case '/earn_tg_post_view_task':\r\n            case '/earn_tg_subscribers_task':\r\n                throw('Извини, таких заданий сейчас нет');\r\n                break;\r\n            default:\r\n                \r\n                const taskname_query = /\\/confirm\\((.*)\\)/g;\r\n\r\n\r\n                if(msg.data.search(taskname_query) >= 0 ){\r\n                    let taskname = taskname_query.exec(msg.data)[1];\r\n                    let task = await user.confirmTask(taskname);\r\n                    const text = \"Ты получил \" + task.cost + \" руб. Спасибо за помощь!\";\r\n\r\n                    user.status = 'free';\r\n                    nMenu.sendNextTaskMenu(user, task.type , text);\r\n                }\r\n                break;\r\n                user.status = 'free';\r\n        }\r\n    }\r\n    catch(err){\r\n        console.log(err.stack);///////////////////////////НЕИЗВЕСТНАЯ ОШИБКА\r\n        await nMenu.sendTextMessage(user, err);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n    bot.answerCallbackQuery(msg.id, \"\", true);\r\n});\r\n\r\nasync function vk_acc_addition(user, link){\r\n    let messageText;\r\n    if(/vk.com\\//.test(link)){\r\n        await user.addVkAcc(link);\r\n        messageText = 'Аккаунт успешно привязан!';\r\n    }\r\n    else \r\n    messageText = \"Неправильная ссылка. Должно быть что-то типа \\'vk.com/id123456789\\'\";\r\n\r\n    user.status = 'free';\r\n    await nMenu.sendTextMessage(user, messageText);\r\n    //nMenu.sendAccsEditionMenu(user);\r\n}\r\n\r\n\r\n"]}