{"version":3,"sources":["../src/interaction.js"],"names":["request","require","cheerio","onText","msg","match","user","getSender","ExistInDB","saveToDB","greeting","sendTextMessage","last_message_id","message_id","status","vk_acc_addition","query","search","link","exec","required","createVkPhotoLikeTask","err","console","log","stack","sendMenu","on","data","sendStats","sendAccsEditionMenu","sendEarnMenu","sendTasksMenu","sendVkCreationTaskMenu","vk_acc","uname","key","createKey","sendConfitmVkAccMenu","delVkAcc","task","GetTaskForUser","sendEarnVkPhotoLikeTaskMenu","taskname_query","taskname","confirmTask","text","cost","sendNextTaskMenu","type","answerCallbackQuery","id","messageText","test","addVkAcc","n","s","length","String","fromCharCode","Math","random","replace"],"mappings":"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","file":"interaction.js","sourcesContent":["let request = require('request');\r\nlet cheerio = require('cheerio');\r\nimport nMenu from './nmenu';\r\nimport bot from './TeleBot';\r\nimport User from './user';\r\nimport Task from './task';\r\nimport { WSAEUSERS } from 'constants';\r\n\r\n\r\nbot.onText(/\\/start/, async function (msg, match) {\r\n\r\n    let user = await User.getSender(msg);\r\n    if(!user.ExistInDB){\r\n        await user.saveToDB();\r\n        var greeting = \"Привет! Этот бот поможет тебе накрутить лайки в соц.сетях, или заработать, просто лайкая других \";\r\n        await nMenu.sendTextMessage(user, greeting);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n    else{\r\n        const greeting = \"С тобой мы уже знакомы\";\r\n        await nMenu.sendTextMessage(user, greeting);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n});\r\n\r\nbot.onText(/(.*)/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n    try{\r\n        user.last_message_id = msg.message_id;\r\n        switch (user.status){\r\n            case 'vk_acc_addition':\r\n                await vk_acc_addition(user, match[1]);\r\n                break;\r\n            case 'create_vk_photo_like_task(link)':\r\n                user.status = 'create_vk_photo_like_task(required){' + match[1] + '})';\r\n                await nMenu.sendTextMessage(user, \"Сколько лайков хочешь получить?\");\r\n                break;\r\n            default:\r\n                const query = /create_vk_photo_like_task\\(required\\)\\{(.*)\\}/g;\r\n                if(user.status.search(query) >= 0){\r\n                    const link = query.exec(user.status)[1];\r\n                    const required = ((/(\\d*)/g).exec(match))[1];\r\n                    await user.createVkPhotoLikeTask(link,match[1]);\r\n                    await nMenu.sendTextMessage(user, \"Молодец, задание создано успешно!\");\r\n                    //nMenu.sendMenu(user);\r\n\r\n                    user.status = 'free';\r\n                    break;\r\n                }\r\n            }\r\n    }\r\n    catch(err){\r\n        console.log(err.stack);\r\n        user.status = 'free';\r\n        await nMenu.sendTextMessage(user, err);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n\r\n});\r\n\r\nbot.onText(/\\/menu/, async function (msg, match) {\r\n    let user = await User.getSender(msg);\r\n\r\n    if(!user.ExistInDB){\r\n        await user.saveToDB();\r\n    }\r\n\r\n    user.last_message_id = msg.message_id;\r\n    nMenu.sendMenu(user);\r\n});\r\n\r\nbot.on('callback_query', async function (msg) {\r\n    let user = await User.getSender(msg);\r\n    try{\r\n        console.log(msg.data);\r\n        switch (msg.data){\r\n            case '/stats':\r\n                nMenu.sendStats(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/profiles':\r\n                nMenu.sendAccsEditionMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/earn':\r\n                nMenu.sendEarnMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/tasks':\r\n                nMenu.sendTasksMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/createTask':\r\n                nMenu.sendVkCreationTaskMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/create_vk_photo_like_task':\r\n                if(user.vk_acc.uname){\r\n                    await nMenu.sendTextMessage(user, 'Пожалуйста, дай нам ссылку на фотографию');\r\n                    user.status = 'create_vk_photo_like_task(link)';\r\n                }\r\n                else{\r\n                    await nMenu.sendTextMessage(user, 'Привяжи ВК аккаунт, чтобы выполнять такие задания');\r\n                    //nMenu.sendMenu(user);\r\n                }\r\n                break;\r\n            case '/addVkAcc':\r\n                var key = createKey(30);\r\n                user.status = 'vk_acc_addition';\r\n                user.key = key;\r\n                nMenu.sendConfitmVkAccMenu(user);\r\n                break;\r\n            case '/delVkAcc':\r\n                await user.delVkAcc();\r\n                await nMenu.sendTextMessage(user,\"Аккаунт благополучно отвязан\");\r\n                user.status = 'free';\r\n                //nMenu.sendMenu(user);\r\n                break;\r\n            case '/menu':\r\n                nMenu.sendMenu(user);\r\n                user.status = 'free';\r\n                break;\r\n            case '/earn_vk_photo_like_task':\r\n                let task = await Task.GetTaskForUser(user, 'vk_photo_like_task');\r\n                console.log(task);\r\n                nMenu.sendEarnVkPhotoLikeTaskMenu(user, task);\r\n                user.status = 'free';\r\n                break;\r\n            default:\r\n                \r\n                const taskname_query = /\\/confirm\\((.*)\\)/g;\r\n\r\n\r\n                if(msg.data.search(taskname_query) >= 0 ){\r\n                    let taskname = taskname_query.exec(msg.data)[1];\r\n                    let task = await user.confirmTask(taskname);\r\n                    const text = \"Ты получил \" + task.cost + \" руб. Спасибо за помощь!\";\r\n\r\n                    user.status = 'free';\r\n                    nMenu.sendNextTaskMenu(user, task.type , text);\r\n                }\r\n                break;\r\n                user.status = 'free';\r\n        }\r\n    }\r\n    catch(err){\r\n        console.log(err.stack);///////////////////////////НЕИЗВЕСТНАЯ ОШИБКА\r\n        await nMenu.sendTextMessage(user, err);\r\n        //nMenu.sendMenu(user);\r\n    }\r\n    bot.answerCallbackQuery(msg.id, \"\", true);\r\n});\r\n\r\nasync function vk_acc_addition(user, link){\r\n    let messageText;\r\n    if(/vk.com\\//.test(link)){\r\n        await user.addVkAcc(link);\r\n        messageText = 'Аккаунт успешно привязан!';\r\n    }\r\n    else \r\n    messageText = \"Неправильная ссылка. Должно быть что-то типа \\'vk.com/id123456789\\'\";\r\n\r\n    user.status = 'free';\r\n    await nMenu.sendTextMessage(user, messageText);\r\n    //nMenu.sendAccsEditionMenu(user);\r\n}\r\n\r\nfunction createKey (n){\r\n    var s ='';\r\n    while(s.length < n)\r\n        s += String.fromCharCode(Math.random() * 1106).replace(/[^a-zA-Z]|_/g,'');\r\n    return s;\r\n}\r\n\r\n"]}