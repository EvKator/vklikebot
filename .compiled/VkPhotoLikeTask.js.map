{"version":3,"sources":["../src/VkPhotoLikeTask.js"],"names":["request","require","cheerio","decode","VkPhotoLikeTask","url","required","author_id","type","taskname","getUrlData","cost","user","likersLink","getLikersLink","result","respHtml","$","load","likers","toArray","some","el","console","log","attribs","href","slice","vk_acc","uname","username","err","stack","urldata","likersUrl","pattern","search","exec"],"mappings":";;;;;;;;AAAA;;;;;;;;;;;;AACA,IAAMA,UAAUC,QAAQ,iBAAR,CAAhB;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,IAAME,SAASF,QAAQ,WAAR,CAAf;;IAEMG,e;;;AACF,6BAAYC,GAAZ,EAAiBC,QAAjB,EAA2BC,SAA3B,EAAqC;AAAA;;AACjC,YAAMC,OAAO,oBAAb;AACA,YAAIC,WAAWL,gBAAgBM,UAAhB,CAA2BL,GAA3B,EAAgC,CAAhC,CAAf;AACA,YAAMM,OAAOP,gBAAgBO,IAA7B;AAHiC,iIAI3BF,QAJ2B,EAIjBD,IAJiB,EAIXH,GAJW,EAINC,QAJM,EAIIA,QAJJ,EAIcK,IAJd,EAIoBJ,SAJpB;AAKpC;;;;oCAEkBK,I,EAAMP,G,EAAI;AACzB,gBAAIQ,aAAaT,gBAAgBU,aAAhB,CAA8BT,GAA9B,CAAjB;AACA,gBAAIU,SAAU,KAAd;AACA,gBAAI;AACA,oBAAIC,WAAW,MAAOhB,QAAQa,UAAR,CAAtB;AACA,oBAAII,IAAIf,QAAQgB,IAAR,CAAaF,QAAb,CAAR;AACA,oBAAIG,SAAUF,EAAE,eAAF,CAAD,CAAqBG,OAArB,EAAb;AACAL,yBAASI,OAAOE,IAAP,CAAY,UAACC,EAAD,EAAM;AACvBC,4BAAQC,GAAR,CAAYF,GAAGG,OAAH,CAAWC,IAAvB;AACA,2BAAOJ,GAAGG,OAAH,CAAWC,IAAX,CAAgBC,KAAhB,CAAsB,CAAtB,MAA6Bf,KAAKgB,MAAL,CAAYC,KAAhD;AACH,iBAHQ,CAAT;AAIAN,wBAAQC,GAAR,CAAYZ,KAAKgB,MAAL,CAAYE,QAAxB;AACH,aATD,CAUA,OAAOC,GAAP,EAAW;AACPR,wBAAQC,GAAR,CAAY,KAAZ;AACAD,wBAAQC,GAAR,CAAYO,IAAIC,KAAhB;AACA,uBAAO,KAAP;AACH;AACD,mBAAOjB,MAAP;AACH;;;sCAEoBV,G,EAAI;AACrB,gBAAI4B,UAAU7B,gBAAgBM,UAAhB,CAA2BL,GAA3B,CAAd;AACA,gBAAI6B,YAAY,8CAA8CD,QAAQ,CAAR,CAA9C,GAA2D,QAA3D,GAAsEA,QAAQ,CAAR,CAAtE,GAAmF,QAAnF,GAA8FA,QAAQ,CAAR,CAA9G;AACAV,oBAAQC,GAAR,CAAYU,SAAZ;AACA,mBAAOA,SAAP;AACH;;;mCAEiB7B,G,EAAI;AAClBkB,oBAAQC,GAAR,CAAYnB,GAAZ;AACAA,kBAAMF,OAAOE,GAAP,CAAN;AACA,gBAAM8B,UAAU,yBAAhB;AACA,gBAAG9B,IAAI+B,MAAJ,CAAWD,OAAX,IAAsB,CAAzB,EACI,MAAO,4GAAP;AACJ,gBAAIF,UAAUE,QAAQE,IAAR,CAAahC,GAAb,CAAd;AACA,mBAAO4B,OAAP;AACH;;;;;;AAML7B,gBAAgBO,IAAhB,GAAuB,CAAvB;;kBAEeP,e","file":"VkPhotoLikeTask.js","sourcesContent":["import Task from './task';\r\nconst request = require('request-promise');\r\nconst cheerio = require('cheerio');\r\nconst decode = require('urldecode');\r\n\r\nclass VkPhotoLikeTask extends Task{\r\n    constructor(url, required, author_id){\r\n        const type = 'vk_photo_like_task';\r\n        let taskname = VkPhotoLikeTask.getUrlData(url)[1];\r\n        const cost = VkPhotoLikeTask.cost;\r\n        super(taskname, type, url, required, required, cost, author_id);\r\n    }\r\n\r\n    static async check(user, url){\r\n        let likersLink = VkPhotoLikeTask.getLikersLink(url);\r\n        let result  = false;\r\n        try {\r\n            let respHtml = await  request(likersLink);\r\n            let $ = cheerio.load(respHtml);\r\n            let likers = ($('a.inline_item')).toArray();\r\n            result = likers.some((el)=>{\r\n                console.log(el.attribs.href);\r\n                return el.attribs.href.slice(1) === user.vk_acc.uname;\r\n            });\r\n            console.log(user.vk_acc.username);\r\n        }\r\n        catch (err){\r\n            console.log('err');\r\n            console.log(err.stack);\r\n            return false;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static getLikersLink(url){\r\n        let urldata = VkPhotoLikeTask.getUrlData(url);\r\n        let likersUrl = \"https://m.vk.com/like?act=members&object=\" + urldata[1] + \"&from=\" + urldata[1] + \"?list=\" + urldata[2];\r\n        console.log(likersUrl);\r\n        return likersUrl;\r\n    }\r\n\r\n    static getUrlData(url){\r\n        console.log(url);\r\n        url = decode(url);\r\n        const pattern = /((photo[^\\/]+)_[^\\/]+)/g;\r\n        if(url.search(pattern) < 0)\r\n            throw (\"Я не нашел по твоей ссылке фотографий из ВК. Пожалуйста, поверь ее или обратись в техподдержку, мы поможем\");\r\n        let urldata = pattern.exec(url);\r\n        return urldata;\r\n    }\r\n\r\n    \r\n\r\n}\r\n\r\nVkPhotoLikeTask.cost = 1;\r\n\r\nexport default VkPhotoLikeTask;"]}