{"version":3,"sources":["../src/VkPhotoLikeTask.js"],"names":["request","require","cheerio","decode","VkPhotoLikeTask","url","required","author_id","type","taskname","getUrlData","cost","user","console","log","likersLink","getLikersLink","result","respHtml","$","load","likers","toArray","some","el","attribs","href","slice","vk_acc","uname","username","err","stack","urldata","likersUrl","pattern","reg","RegExp","exec"],"mappings":";;;;;;;;AAAA;;;;;;;;;;;;AACA,IAAMA,UAAUC,QAAQ,iBAAR,CAAhB;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,IAAME,SAASF,QAAQ,WAAR,CAAf;;IAEqBG,e;;;AAEjB,6BAAYC,GAAZ,EAAiBC,QAAjB,EAA2BC,SAA3B,EAAqC;AAAA;;AACjC,YAAMC,OAAO,oBAAb;AACA,YAAIC,WAAWL,gBAAgBM,UAAhB,CAA2BL,GAA3B,EAAgC,CAAhC,CAAf;AACA,YAAMM,OAAO,CAAb;AAHiC,iIAI3BF,QAJ2B,EAIjBD,IAJiB,EAIXH,GAJW,EAINC,QAJM,EAIIA,QAJJ,EAIcK,IAJd,EAIoBJ,SAJpB;AAKpC;;;;oCAEkBK,I,EAAMP,G,EAAI;AACzBQ,oBAAQC,GAAR,CAAY,kBAAZ;AACA,gBAAIC,aAAaX,gBAAgBY,aAAhB,CAA8BX,GAA9B,CAAjB;AACA,gBAAIY,SAAU,KAAd;AACA,gBAAI;AACA,oBAAIC,WAAW,MAAOlB,QAAQe,UAAR,CAAtB;AACA,oBAAII,IAAIjB,QAAQkB,IAAR,CAAaF,QAAb,CAAR;AACA,oBAAIG,SAAUF,EAAE,eAAF,CAAD,CAAqBG,OAArB,EAAb;AACAL,yBAASI,OAAOE,IAAP,CAAY,UAACC,EAAD,EAAM;AACvBX,4BAAQC,GAAR,CAAYU,GAAGC,OAAH,CAAWC,IAAvB;AACA,2BAAOF,GAAGC,OAAH,CAAWC,IAAX,CAAgBC,KAAhB,CAAsB,CAAtB,MAA6Bf,KAAKgB,MAAL,CAAYC,KAAhD;AACH,iBAHQ,CAAT;AAIAhB,wBAAQC,GAAR,CAAYF,KAAKgB,MAAL,CAAYE,QAAxB;AACH,aATD,CAUA,OAAOC,GAAP,EAAW;AACPlB,wBAAQC,GAAR,CAAY,KAAZ;AACAD,wBAAQC,GAAR,CAAYiB,IAAIC,KAAhB;AACA,uBAAO,KAAP;AACH;AACD,mBAAOf,MAAP;AACH;;;sCAEoBZ,G,EAAI;AACrB,gBAAI4B,UAAU7B,gBAAgBM,UAAhB,CAA2BL,GAA3B,CAAd;AACA,gBAAI6B,YAAY,8CAA8CD,QAAQ,CAAR,CAA9C,GAA2D,QAA3D,GAAsEA,QAAQ,CAAR,CAAtE,GAAmF,QAAnF,GAA8FA,QAAQ,CAAR,CAA9G;AACA,mBAAOC,SAAP;AACH;;;mCAEiB7B,G,EAAI;AAClBQ,oBAAQC,GAAR,CAAYT,GAAZ;AACAA,kBAAMF,OAAOE,GAAP,CAAN;AACA,gBAAM8B,UAAU,wBAAhB;AACA,gBAAIC,MAAM,IAAIC,MAAJ,CAAWF,OAAX,EAAoB,GAApB,CAAV;AACA,gBAAIF,UAAUG,IAAIE,IAAJ,CAASjC,GAAT,CAAd;AACA,mBAAO4B,OAAP;AACH;;;;;;kBA5CgB7B,e","file":"VkPhotoLikeTask.js","sourcesContent":["import Task from './task';\r\nconst request = require('request-promise');\r\nconst cheerio = require('cheerio');\r\nconst decode = require('urldecode');\r\n\r\nexport default class VkPhotoLikeTask extends Task{\r\n\r\n    constructor(url, required, author_id){\r\n        const type = 'vk_photo_like_task';\r\n        let taskname = VkPhotoLikeTask.getUrlData(url)[1];\r\n        const cost = 1;\r\n        super(taskname, type, url, required, required, cost, author_id);\r\n    }\r\n\r\n    static async check(user, url){\r\n        console.log('0000000000000000');\r\n        let likersLink = VkPhotoLikeTask.getLikersLink(url);\r\n        let result  = false;\r\n        try {\r\n            let respHtml = await  request(likersLink);\r\n            let $ = cheerio.load(respHtml);\r\n            let likers = ($('a.inline_item')).toArray();\r\n            result = likers.some((el)=>{\r\n                console.log(el.attribs.href);\r\n                return el.attribs.href.slice(1) === user.vk_acc.uname;\r\n            });\r\n            console.log(user.vk_acc.username);\r\n        }\r\n        catch (err){\r\n            console.log('err');\r\n            console.log(err.stack);\r\n            return false;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static getLikersLink(url){\r\n        let urldata = VkPhotoLikeTask.getUrlData(url);\r\n        let likersUrl = \"https://m.vk.com/like?act=members&object=\" + urldata[1] + \"&from=\" + urldata[1] + \"?list=\" + urldata[2];\r\n        return likersUrl;\r\n    }\r\n\r\n    static getUrlData(url){\r\n        console.log(url);\r\n        url = decode(url);\r\n        const pattern = \"((photo[^\\/]+)_[^\\/]+)\";\r\n        let reg = new RegExp(pattern, 'g');\r\n        let urldata = reg.exec(url);\r\n        return urldata;\r\n    }\r\n\r\n}"]}