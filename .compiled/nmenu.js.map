{"version":3,"sources":["../src/nmenu.js"],"names":["nMenu","user","text","reply_markup","_sendMessage","vk_acc","uname","sendNew","tasktype","task","url","parse_mode","taskname","balance","key","deleteMessage","id","menu_id","err","last_message_id","_sendNew","_replaceText","editMessageReplyMarkup","chat_id","message_id","editMessageText","deleteMenu","_sendAndRemember","sendMessage","then","msg"],"mappings":"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","file":"nmenu.js","sourcesContent":["import bot from './TeleBot';\r\n\r\nexport default class nMenu {\r\n\r\n    static async sendMenu(user) {\r\n        const text = \"Чего желаешь, пользователь?\";\r\n        const reply_markup = {\r\n                \"inline_keyboard\": [\r\n                    [{\"text\": \"Статистика\", \"callback_data\": \"/stats\"}],\r\n                    [{\"text\": \"Выполнять задания\", \"callback_data\": \"/earn\"}],\r\n                    [{\"text\": \"Создать задание\", \"callback_data\": \"/createTask\"}],\r\n                    [{\"text\": \"Привязанные аккаунты\", \"callback_data\": \"/profiles\"}]\r\n                ]\r\n        }\r\n        await nMenu._sendMessage(user, text, reply_markup);\r\n    }\r\n\r\n    static async sendAccsEditionMenu(user) {\r\n        let text;\r\n        let reply_markup;\r\n        if(!user.vk_acc.uname){\r\n            text = \"Сейчас твой ВК аккаунт не привязан. Хочешь привязать?\";\r\n            reply_markup = {\r\n                \"inline_keyboard\": [\r\n                    [{\"text\": \"Привязать аккаунт\", \"callback_data\": \"/addVkAcc\"}],\r\n                    [{\"text\": \"В меню!\", \"callback_data\": \"/menu\"}]\r\n                ]\r\n            };\r\n        }\r\n        else{\r\n            text = \"Ты привязал страницу http://vk.com/\" + user.vk_acc.uname;\r\n            reply_markup = {\r\n                \"inline_keyboard\": [\r\n                    [{\"text\": \"Отвязать аккаунт\", \"callback_data\": \"/delVkAcc\"}],\r\n                    [{\"text\": \"В меню!\", \"callback_data\": \"/menu\"}]\r\n                ]\r\n            };\r\n        }\r\n        await nMenu._sendMessage(user, text, reply_markup);\r\n    }\r\n    static async sendVkCreationTaskMenu(user) {\r\n        const text = \"Какое задание хочешь создать?\";\r\n        const reply_markup = {\r\n            \"inline_keyboard\": [\r\n                [{\"text\": \"Накрутка лайков ВК\", \"callback_data\": \"/create_vk_photo_like_task\"}],\r\n                [{\"text\": \"Назад\", \"callback_data\": \"/menu\"}]\r\n            ]\r\n        };\r\n        await nMenu._sendMessage(user,text,reply_markup);\r\n    }\r\n\r\n    static async sendEarnMenu(user, sendNew) {\r\n        const text = \"Какие задания хочешь выполнять?\";\r\n        const reply_markup = {\r\n            \"inline_keyboard\": [\r\n                [{\"text\": \"Лайки на фото в ВК\", \"callback_data\": \"/earn_vk_photo_like_task\"}],\r\n                [{\"text\": \"Назад\", \"callback_data\": \"/menu\"}]\r\n            ]\r\n        };\r\n        await nMenu._sendMessage(user,text,reply_markup);\r\n    }\r\n\r\n    static async sendNextTaskMenu(user, tasktype, text){\r\n        if(!text)\r\n            text = \"Чего желаешь, человек?\";\r\n        const reply_markup = {\r\n            \"inline_keyboard\": [\r\n                [{\"text\": \"Следующее задание\", \"callback_data\": \"/earn_\"+tasktype}],\r\n                [{\"text\": \"Выйти в меню\", \"callback_data\": \"/menu\"}]\r\n            ]\r\n        };\r\n        await nMenu._sendMessage(user,text,reply_markup);\r\n    }\r\n\r\n    static async sendEarnVkPhotoLikeTaskMenu(user, task) {\r\n        const text = \"Поставь лайк на [фотографию](\" + task.url + \")\";\r\n        const parse_mode = \"Markdown\";\r\n        const reply_markup = {\r\n            \"inline_keyboard\": [\r\n                [{\"text\": \"Перейти к фотке\", \"url\": task.url, \"callback_data\": \"/goToPhoto(\" + task.taskname + \")\"}],\r\n                [{\"text\": \"Я поставил лайк\", \"callback_data\": \"/confirm(\" + task.taskname + \")\"}],\r\n                [{\"text\": \"Пропустить\", \"callback_data\": \"/skip(\" + task.taskname + \")\"}],\r\n                [{\"text\": \"В меню!\", \"callback_data\": \"/menu\"}]\r\n            ]\r\n        };\r\n        await nMenu._sendMessage(user,text,reply_markup, parse_mode);\r\n    }\r\n\r\n    static async sendStats(user) {\r\n        const parse_mode = 'HTML';\r\n        const reply_markup = {\r\n            \"inline_keyboard\": [\r\n                [{\"text\": \"В меню!\", \"callback_data\": \"/menu\"}]\r\n            ]\r\n        };\r\n        let text = \"Баланс: \" + user.balance + \" руб\";\r\n        await nMenu._sendMessage(user,text,reply_markup, parse_mode);\r\n    }\r\n\r\n    static async sendConfitmVkAccMenu(user){\r\n        const parse_mode = 'HTML';\r\n        let text = \"Укаже на странице в статусе этот код: <code>\" +\r\n            user.key + \"</code> и ПОСЛЕ пришли ссылку на нее\";\r\n        const reply_markup = {\r\n            \"inline_keyboard\": [\r\n                [{\"text\":\"Перейти к ВК\", \"callback_data\" :\"/openvk\", \"url\" : \"https://vk.com/id0\"}],\r\n                [{\"text\":\"В меню!\", \"callback_data\" :\"/menu\"}]\r\n            ]\r\n        };\r\n        await nMenu._sendMessage(user,text,reply_markup, parse_mode);\r\n    }\r\n\r\n    static async deleteMenu(user){\r\n        try{\r\n            bot.deleteMessage(user.id, user.menu_id);\r\n        }\r\n        catch(err){}\r\n    }\r\n\r\n    static async _sendMessage(user, text, reply_markup, parse_mode){\r\n        let sendNew = !(user.last_message_id == user.menu_id);\r\n        if(sendNew){\r\n            await nMenu._sendNew(user, text, reply_markup, parse_mode);\r\n        }\r\n        else{\r\n            await nMenu._replaceText(user, text, reply_markup, parse_mode);\r\n        }\r\n    }\r\n\r\n    static async _replaceMarkup(user, text, reply_markup, parse_mode){\r\n        await bot.editMessageReplyMarkup(reply_markup, {chat_id: user.id, message_id: user.menu_id});\r\n    }\r\n\r\n    static async _replaceText(user, text, reply_markup, parse_mode){\r\n        await bot.editMessageText(text, {chat_id: user.id, message_id: user.menu_id, reply_markup: reply_markup, parse_mode: parse_mode});\r\n    }\r\n    \r\n\r\n    static async _sendNew(user, text, reply_markup, parse_mode){\r\n        //try{\r\n            await nMenu.deleteMenu(user);\r\n        //}\r\n        //catch(err){}\r\n        nMenu._sendAndRemember(user, text, reply_markup, parse_mode);\r\n    }\r\n\r\n    static async _sendAndRemember(user, text, reply_markup, parse_mode){\r\n        await bot.sendMessage(user.id, text, {parse_mode: 'HTML', reply_markup: reply_markup}).then(function (msg) {\r\n            user.menu_id = msg.message_id;\r\n            user.last_message_id = msg.message_id;\r\n        });\r\n    }\r\n\r\n    static async sendTextMessage(user, text, reply_markup, parse_mode){\r\n        reply_markup = {\r\n            \"inline_keyboard\": [\r\n                [{\"text\": \"В меню!\", \"callback_data\": \"/menu\"}]\r\n            ]\r\n        };\r\n        nMenu._sendNew(user,text,reply_markup);\r\n        // await bot.sendMessage(user.id, text, {parse_mode: 'HTML', reply_markup: reply_markup}).then(function (msg) {\r\n        //     user.last_message_id = msg.message_id;\r\n        // });\r\n    }\r\n}"]}