{"version":3,"sources":["../src/dataManage.js"],"names":["app","require","bot","fs","FNAME_USERS","CreateUser","msg","telegUser","from","NewUser","id","chat","first_name","last_name","username","language_code","award","user","salary","balance","Number","changeUser","console","log","setStatus","status","setLastTask","lastTask","setParam","param","value","setBalance","userExist","isUserExist","users","getUserList","data","JSON","stringify","writeFileSync","readFileSync","parse","getUser","addUser","removeUser","user_id","module","exports"],"mappings":"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","file":"dataManage.js","sourcesContent":["var app = require('../app.js');\r\nvar bot = app.bot;\r\nvar fs = require('fs');\r\nconst  FNAME_USERS = \"users.json\";\r\n\r\nfunction CreateUser(msg){\r\n    var telegUser = msg.from;\r\n    var NewUser = {\r\n        \"id\" : telegUser.id,\r\n        \"chat_id\" : msg.chat.id,\r\n        \"first_name\" : telegUser.first_name,\r\n        \"last_name\" : telegUser.last_name,\r\n        \"username\" : telegUser.username,\r\n        \"language_code\" : telegUser.language_code,\r\n        \"balance\" : 0,\r\n        \"status\": \"created\",\r\n        \"key\": \"0\",\r\n        \"vk_accs\" : [],\r\n        \"lastVkPhotoLiked\" : \"\",\r\n        \"tasks\" : []\r\n    };\r\n    return NewUser;\r\n}\r\n\r\nfunction award(user, salary){\r\n    user.balance = Number(user.balance) + Number(salary);\r\n    changeUser(user);\r\n    console.log(user.balance + \", \" + salary);\r\n    console.log(user);\r\n}\r\n\r\nfunction setStatus(user, status) {\r\n    user.status = status;\r\n    changeUser(user);\r\n}\r\n\r\nfunction setLastTask(user, status) {\r\n    user.lastTask = status;\r\n    changeUser(user);\r\n}\r\n\r\nfunction setParam(user, param, value) {\r\n    user.param = value;\r\n    changeUser(user);\r\n}\r\n\r\nfunction setBalance(user, value) {\r\n    user.balance = value;\r\n    changeUser(user);\r\n}\r\n\r\nfunction changeUser(user) {\r\n    var userExist = isUserExist(user.id);\r\n    if(userExist){\r\n        var users = getUserList();\r\n        users[user.id] = user;\r\n        var data = JSON.stringify(users, \"\", 4);\r\n        fs.writeFileSync(FNAME_USERS, data);\r\n        return true;\r\n    }\r\n    else return false;\r\n}\r\n\r\nfunction  getUserList() {\r\n    var data = fs.readFileSync(FNAME_USERS, 'utf-8');\r\n    var users = JSON.parse(data);\r\n    return users;\r\n}\r\n\r\n\r\nfunction  getUser(id) {\r\n    var user = getUserList()[id];\r\n    if (typeof user === 'undefined' || user === null) {\r\n        user = 0;\r\n    }\r\n    return user;\r\n}\r\n\r\nfunction  isUserExist(id) {\r\n    if(getUser(id)) return true;\r\n    return false;\r\n}\r\n\r\nfunction  addUser(user) {\r\n    var userExist = isUserExist(user.id);\r\n    if(!userExist){\r\n        var users = getUserList();\r\n        users[user.id] = user;\r\n        var data = JSON.stringify(users, \"\", 4);\r\n        console.log(data);\r\n        fs.writeFileSync(FNAME_USERS, data);\r\n    }\r\n}\r\n\r\nfunction  removeUser(user_id) {}////////////////////////////////////////////\r\n\r\n\r\nmodule.exports = {\r\n    setLastTask : setLastTask,\r\n    CreateUser : CreateUser,\r\n    setBalance : setBalance,\r\n    setParam : setParam,\r\n    setStatus : setStatus,\r\n    changeUser : changeUser,\r\n    getUserList : getUserList,\r\n    getUser : getUser,\r\n    isUserExist : isUserExist,\r\n    addUser : addUser,\r\n    removeUser : removeUser,\r\n    award : award\r\n};\r\n"]}