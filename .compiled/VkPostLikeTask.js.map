{"version":3,"sources":["../src/VkPostLikeTask.js"],"names":["request","require","cheerio","decode","VkPostLikeTask","url","required","author_id","type","taskname","getUrlData","cost","user","likersLink","getLikersLink","result","respHtml","$","load","likers","toArray","some","el","console","log","attribs","href","slice","vk_acc","uname","username","err","stack","urldata","likersUrl","pattern","search","exec","task","msg","String","Number","remain"],"mappings":";;;;;;;;AAAA;;;;;;;;;;;;AACA,IAAMA,UAAUC,QAAQ,iBAAR,CAAhB;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,IAAME,SAASF,QAAQ,WAAR,CAAf;;IAEMG,c;;;AAEF,4BAAYC,GAAZ,EAAiBC,QAAjB,EAA2BC,SAA3B,EAAqC;AAAA;;AACjC,YAAMC,OAAO,mBAAb;AACA,YAAIC,WAAWL,eAAeM,UAAf,CAA0BL,GAA1B,EAA+B,CAA/B,CAAf;AACA,YAAMM,OAAOP,eAAeO,IAA5B;AAHiC,+HAI3BF,QAJ2B,EAIjBD,IAJiB,EAIXH,GAJW,EAINC,QAJM,EAIIA,QAJJ,EAIcK,IAJd,EAIoBJ,SAJpB;AAKpC;;;;oCAEkBK,I,EAAMP,G,EAAI;AACzB,gBAAIQ,aAAaT,eAAeU,aAAf,CAA6BT,GAA7B,CAAjB;AACA,gBAAIU,SAAU,KAAd;AACA,gBAAI;AACA,oBAAIC,WAAW,MAAOhB,QAAQa,UAAR,CAAtB;AACA,oBAAII,IAAIf,QAAQgB,IAAR,CAAaF,QAAb,CAAR;AACA,oBAAIG,SAAUF,EAAE,eAAF,CAAD,CAAqBG,OAArB,EAAb;AACAL,yBAASI,OAAOE,IAAP,CAAY,UAACC,EAAD,EAAM;AACvBC,4BAAQC,GAAR,CAAYF,GAAGG,OAAH,CAAWC,IAAvB;AACA,2BAAOJ,GAAGG,OAAH,CAAWC,IAAX,CAAgBC,KAAhB,CAAsB,CAAtB,MAA6Bf,KAAKgB,MAAL,CAAYC,KAAhD;AACH,iBAHQ,CAAT;AAIAN,wBAAQC,GAAR,CAAYZ,KAAKgB,MAAL,CAAYE,QAAxB;AACH,aATD,CAUA,OAAOC,GAAP,EAAW;AACPR,wBAAQC,GAAR,CAAY,KAAZ;AACAD,wBAAQC,GAAR,CAAYO,IAAIC,KAAhB;AACA,uBAAO,KAAP;AACH;AACD,mBAAOjB,MAAP;AACH;;;sCAEoBV,G,EAAI;AACrB,gBAAI4B,UAAU7B,eAAeM,UAAf,CAA0BL,GAA1B,CAAd;AACA,gBAAI6B,YAAY,8CAA8CD,QAAQ,CAAR,CAA9D;AACAV,oBAAQC,GAAR,CAAYU,SAAZ;AACA,mBAAOA,SAAP;AACH;;;mCAEiB7B,G,EAAI;;AAElBkB,oBAAQC,GAAR,CAAYnB,GAAZ;AACAA,kBAAMF,OAAOE,GAAP,CAAN;AACA,gBAAM8B,UAAU,gBAAhB;AACA,gBAAG9B,IAAI+B,MAAJ,CAAWD,OAAX,IAAsB,CAAzB,EACI,MAAO,sGAAP;AACJ,gBAAIF,UAAUE,QAAQE,IAAR,CAAahC,GAAb,CAAd;AACA,mBAAO4B,OAAP;AACH;;;iCAEeK,I,EAAK;AACjB,gBAAIC,MAAM,cAAcC,OAAOF,KAAKhC,QAAZ,CAAd,GAAsC,oBAAtC,GAA6DgC,KAAKjC,GAAlE,GAAwE,MAAxE,GACN,YADM,GACSmC,OAAOC,OAAOH,KAAKhC,QAAZ,IAAwBmC,OAAOH,KAAKI,MAAZ,CAA/B,CADT,GAC+D,IAD/D,GAEN,aAFM,GAEUF,OAAOC,OAAOH,KAAK3B,IAAZ,IAAoB8B,OAAOH,KAAKhC,QAAZ,CAA3B,CAFV,GAE8D,QAF9D,GAGN,WAHJ;AAIA,mBAAOiC,GAAP;AACH;;;;;;AAILnC,eAAeO,IAAf,GAAsB,GAAtB;;kBAEeP,c","file":"VkPostLikeTask.js","sourcesContent":["import Task from './task';\r\nconst request = require('request-promise');\r\nconst cheerio = require('cheerio');\r\nconst decode = require('urldecode');\r\n\r\nclass VkPostLikeTask extends Task{\r\n    \r\n    constructor(url, required, author_id){\r\n        const type = 'vk_post_like_task';\r\n        let taskname = VkPostLikeTask.getUrlData(url)[1];\r\n        const cost = VkPostLikeTask.cost;\r\n        super(taskname, type, url, required, required, cost, author_id);\r\n    }\r\n\r\n    static async check(user, url){\r\n        let likersLink = VkPostLikeTask.getLikersLink(url);\r\n        let result  = false;\r\n        try {\r\n            let respHtml = await  request(likersLink);\r\n            let $ = cheerio.load(respHtml);\r\n            let likers = ($('a.inline_item')).toArray();\r\n            result = likers.some((el)=>{\r\n                console.log(el.attribs.href);\r\n                return el.attribs.href.slice(1) === user.vk_acc.uname;\r\n            });\r\n            console.log(user.vk_acc.username);\r\n        }\r\n        catch (err){\r\n            console.log('err');\r\n            console.log(err.stack);\r\n            return false;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static getLikersLink(url){\r\n        let urldata = VkPostLikeTask.getUrlData(url);\r\n        let likersUrl = \"https://m.vk.com/like?act=members&object=\" + urldata[1];\r\n        console.log(likersUrl);\r\n        return likersUrl;\r\n    }\r\n\r\n    static getUrlData(url){\r\n\r\n        console.log(url);\r\n        url = decode(url);\r\n        const pattern = /(wall\\d+_\\d+)/g;\r\n        if(url.search(pattern) < 0)\r\n            throw (\"Я не нашел по твоей ссылке пост из ВК. Пожалуйста, поверь ее или обратись в техподдержку, мы поможем\");\r\n        let urldata = pattern.exec(url);\r\n        return urldata;\r\n    }\r\n\r\n    static toString(task){\r\n        let msg = \"Задание: \" + String(task.required) + \" лайков на [пост](\" + task.url + \") \\n\" +\r\n            \"лайкнуло: \" + String(Number(task.required) - Number(task.remain)) + \"\\n\" +\r\n            \"затрачено: \" + String(Number(task.cost) * Number(task.required)) + \" руб\\n\" +\r\n            \"---------\";\r\n        return msg;\r\n    }\r\n\r\n}\r\n\r\nVkPostLikeTask.cost = 0.2;\r\n\r\nexport default VkPostLikeTask;"]}